{
  "info": {
    "name": "QI FdR KPI DEV",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Calculate Monthly KPI - Success (Direct PSP)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Calculate Monthly KPI - Success Response\", function () {",
              "    pm.response.to.have.status(200);",
              "    const response = pm.response.json();",
              "    pm.expect(response).to.have.property('responseType').to.equal('monthly');",
              "    pm.expect(response).to.have.property('idPsp');",
              "    pm.expect(response).to.have.property('kpiName');",
              "    pm.expect(response).to.have.property('kpiDescription');",
              "    pm.expect(response).to.have.property('kpiDescriptionUrl');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Ocp-Apim-Subscription-Key",
            "value": "{{API_SUBSCRIPTION_KEY}}",
            "type": "text"
          },
          {
            "key": "deployment",
            "value": "{{DEPLOYMENT}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{HOSTNAME}}/qi/fdr-kpi-service/v1/fdr-kpi/{{KPI_TYPE}}?pspId={{PSP_ID}}&period={{PERIOD_MONTHLY}}&date={{DATE}}",
          "host": ["{{HOSTNAME}}"],
          "path": [
            "qi",
            "fdr-kpi-service",
            "v1",
            "fdr-kpi",
            "{{KPI_TYPE}}"
          ],
          "query": [
            {
              "key": "pspId",
              "value": "{{PSP_ID}}"
            },
            {
              "key": "period",
              "value": "{{PERIOD_MONTHLY}}"
            },
            {
              "key": "date",
              "value": "{{DATE}}"
            }
          ]
        }
      }
    },
    {
      "name": "Calculate KPI - PSP Not Found",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"PSP Not Found - Status code is 404\", function () {",
              "    pm.response.to.have.status(404);",
              "    const response = pm.response.json();",
              "    pm.expect(response).to.have.property('status').to.equal(404);",
              "    pm.expect(response).to.have.property('title');",
              "    pm.expect(response).to.have.property('detail');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Ocp-Apim-Subscription-Key",
            "value": "{{API_SUBSCRIPTION_KEY}}",
            "type": "text"
          },
          {
            "key": "deployment",
            "value": "{{DEPLOYMENT}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{HOSTNAME}}/qi/fdr-kpi-service/v1/fdr-kpi/{{KPI_TYPE}}?pspId={{PSP_ID_NOT_FOUND}}&period={{PERIOD_MONTHLY}}&date={{DATE}}",
          "host": ["{{HOSTNAME}}"],
          "path": [
            "qi",
            "fdr-kpi-service",
            "v1",
            "fdr-kpi",
            "{{KPI_TYPE}}"
          ],
          "query": [
            {
              "key": "pspId",
              "value": "{{PSP_ID_NOT_FOUND}}"
            },
            {
              "key": "period",
              "value": "{{PERIOD_MONTHLY}}"
            },
            {
              "key": "date",
              "value": "{{DATE}}"
            }
          ]
        }
      },
      "response": []
    },
    {
      "name": "Calculate KPI - Invalid KPI Type",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Invalid KPI Type - Status code is 400\", function () {",
              "    pm.response.to.have.status(400);",
              "    const response = pm.response.json();",
              "    pm.expect(response).to.have.property('status').to.equal(400);",
              "    pm.expect(response).to.have.property('title');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Ocp-Apim-Subscription-Key",
            "value": "{{API_SUBSCRIPTION_KEY}}",
            "type": "text"
          },
          {
            "key": "deployment",
            "value": "{{DEPLOYMENT}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{HOSTNAME}}/qi/fdr-kpi-service/v1/fdr-kpi/{{KPI_TYPE_NOT_VALID}}?pspId={{PSP_ID}}&period={{PERIOD_MONTHLY}}&date={{DATE}}",
          "host": ["{{HOSTNAME}}"],
          "path": [
            "qi",
            "fdr-kpi-service",
            "v1",
            "fdr-kpi",
            "{{KPI_TYPE_NOT_VALID}}"
          ],
          "query": [
            {
              "key": "pspId",
              "value": "{{PSP_ID}}"
            },
            {
              "key": "period",
              "value": "{{PERIOD_MONTHLY}}"
            },
            {
              "key": "date",
              "value": "{{DATE}}"
            }
          ]
        }
      },
      "response": []
    },
    {
      "name": "Calculate KPI - Invalid Period",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Invalid Period - Status code is 400\", function () {",
              "    pm.response.to.have.status(400);",
              "    const response = pm.response.json();",
              "    pm.expect(response).to.have.property('status').to.equal(400);",
              "    pm.expect(response).to.have.property('title');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Ocp-Apim-Subscription-Key",
            "value": "{{API_SUBSCRIPTION_KEY}}",
            "type": "text"
          },
          {
            "key": "deployment",
            "value": "{{DEPLOYMENT}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{HOSTNAME}}/qi/fdr-kpi-service/v1/fdr-kpi/{{KPI_TYPE}}?pspId={{PSP_ID}}&period={{PERIOD_NOT_VALID}}&date={{DATE}}",
          "host": ["{{HOSTNAME}}"],
          "path": [
            "qi",
            "fdr-kpi-service",
            "v1",
            "fdr-kpi",
            "{{KPI_TYPE}}"
          ],
          "query": [
            {
              "key": "pspId",
              "value": "{{PSP_ID}}"
            },
            {
              "key": "period",
              "value": "{{PERIOD_NOT_VALID}}"
            },
            {
              "key": "date",
              "value": "{{DATE}}"
            }
          ]
        }
      },
      "response": []
    },
    {
      "name": "Calculate KPI - Date Too Recent",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Date Too Recent - Status code is 400\", function () {",
              "    pm.response.to.have.status(400);",
              "    const response = pm.response.json();",
              "    pm.expect(response).to.have.property('status').to.equal(400);",
              "    pm.expect(response.title).to.equal('Date Too Recent');",
              "    pm.expect(response.detail).to.equal('Daily KPI requests must be for dates at least 10 days in the past');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Ocp-Apim-Subscription-Key",
            "value": "{{API_SUBSCRIPTION_KEY}}",
            "type": "text"
          },
          {
            "key": "deployment",
            "value": "{{DEPLOYMENT}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{HOSTNAME}}/qi/fdr-kpi-service/v1/fdr-kpi/{{KPI_TYPE}}?pspId={{PSP_ID}}&period={{PERIOD_DAILY}}&date={{DATE_TOO_RECENT}}",
          "host": ["{{HOSTNAME}}"],
          "path": [
            "qi",
            "fdr-kpi-service",
            "v1",
            "fdr-kpi",
            "{{KPI_TYPE}}"
          ],
          "query": [
            {
              "key": "pspId",
              "value": "{{PSP_ID}}"
            },
            {
              "key": "period",
              "value": "{{PERIOD_DAILY}}"
            },
            {
              "key": "date",
              "value": "{{DATE_TOO_RECENT}}"
            }
          ]
        }
      },
      "response": []
    },
    {
      "name": "Calculate KPI - Invalid Date Format",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Invalid Date Format - Status code is 400\", function () {",
              "    pm.response.to.have.status(400);",
              "    const response = pm.response.json();",
              "    pm.expect(response).to.have.property('status').to.equal(400);",
              "    pm.expect(response).to.have.property('title');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Ocp-Apim-Subscription-Key",
            "value": "{{API_SUBSCRIPTION_KEY}}",
            "type": "text"
          },
          {
            "key": "deployment",
            "value": "{{DEPLOYMENT}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{HOSTNAME}}/qi/fdr-kpi-service/v1/fdr-kpi/{{KPI_TYPE}}?pspId={{PSP_ID}}&period={{PERIOD_MONTHLY}}&date={{DATE_NOT_VALID}}",
          "host": ["{{HOSTNAME}}"],
          "path": [
            "qi",
            "fdr-kpi-service",
            "v1",
            "fdr-kpi",
            "{{KPI_TYPE}}"
          ],
          "query": [
            {
              "key": "pspId",
              "value": "{{PSP_ID}}"
            },
            {
              "key": "period",
              "value": "{{PERIOD_MONTHLY}}"
            },
            {
              "key": "date",
              "value": "{{DATE_NOT_VALID}}"
            }
          ]
        }
      },
      "response": []
    }
  ]
}